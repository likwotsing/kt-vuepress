<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP缓存 | 前端知识</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/kt-vuepress/favicon.ico">
    <meta name="description" content="前端知识点汇总">
    <link rel="preload" href="/kt-vuepress/assets/css/0.styles.008cb6a5.css" as="style"><link rel="preload" href="/kt-vuepress/assets/js/app.ed2bf4cb.js" as="script"><link rel="preload" href="/kt-vuepress/assets/js/2.90c87c0b.js" as="script"><link rel="preload" href="/kt-vuepress/assets/js/19.dd52f1c3.js" as="script"><link rel="prefetch" href="/kt-vuepress/assets/js/10.bc474c2c.js"><link rel="prefetch" href="/kt-vuepress/assets/js/11.baaedd31.js"><link rel="prefetch" href="/kt-vuepress/assets/js/12.b7202efa.js"><link rel="prefetch" href="/kt-vuepress/assets/js/13.185f35f5.js"><link rel="prefetch" href="/kt-vuepress/assets/js/14.941cc136.js"><link rel="prefetch" href="/kt-vuepress/assets/js/15.7cbd78cd.js"><link rel="prefetch" href="/kt-vuepress/assets/js/16.c57856a1.js"><link rel="prefetch" href="/kt-vuepress/assets/js/17.9757842d.js"><link rel="prefetch" href="/kt-vuepress/assets/js/18.ee37bb82.js"><link rel="prefetch" href="/kt-vuepress/assets/js/20.5a6d09eb.js"><link rel="prefetch" href="/kt-vuepress/assets/js/21.c0064c9d.js"><link rel="prefetch" href="/kt-vuepress/assets/js/22.fe268a2c.js"><link rel="prefetch" href="/kt-vuepress/assets/js/23.229d8b3b.js"><link rel="prefetch" href="/kt-vuepress/assets/js/24.e8022dff.js"><link rel="prefetch" href="/kt-vuepress/assets/js/25.7e23b398.js"><link rel="prefetch" href="/kt-vuepress/assets/js/26.2c431f60.js"><link rel="prefetch" href="/kt-vuepress/assets/js/27.b27e3ad7.js"><link rel="prefetch" href="/kt-vuepress/assets/js/28.2833b8d3.js"><link rel="prefetch" href="/kt-vuepress/assets/js/29.00d7e7b5.js"><link rel="prefetch" href="/kt-vuepress/assets/js/3.468495df.js"><link rel="prefetch" href="/kt-vuepress/assets/js/30.f2c128be.js"><link rel="prefetch" href="/kt-vuepress/assets/js/31.e305f032.js"><link rel="prefetch" href="/kt-vuepress/assets/js/32.13554f83.js"><link rel="prefetch" href="/kt-vuepress/assets/js/33.bafe657c.js"><link rel="prefetch" href="/kt-vuepress/assets/js/4.44d64a9c.js"><link rel="prefetch" href="/kt-vuepress/assets/js/5.e59dee5d.js"><link rel="prefetch" href="/kt-vuepress/assets/js/6.4277a135.js"><link rel="prefetch" href="/kt-vuepress/assets/js/7.b1b6eba7.js"><link rel="prefetch" href="/kt-vuepress/assets/js/8.810bce6f.js"><link rel="prefetch" href="/kt-vuepress/assets/js/9.6b0f248e.js">
    <link rel="stylesheet" href="/kt-vuepress/assets/css/0.styles.008cb6a5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kt-vuepress/" class="home-link router-link-active"><img src="/kt-vuepress/assets/img/logo.png" alt="前端知识" class="logo"> <span class="site-name can-hide">前端知识</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kt-vuepress/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/kt-vuepress/zh/server/" class="nav-link">
  Sever
</a></div><div class="nav-item"><a href="/kt-vuepress/zh/javascript/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/kt-vuepress/zh/node/" class="nav-link router-link-active">
  Node
</a></div><div class="nav-item"><a href="/kt-vuepress/zh/explore/" class="nav-link">
  探索
</a></div><div class="nav-item"><a href="/kt-vuepress/zh/relation/" class="nav-link">
  相关
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          微信
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/kt-vuepress/zh/wx/gzh.html" class="nav-link">
  公众号
</a></li><li class="dropdown-subitem"><a href="/kt-vuepress/zh/wx/xcx.html" class="nav-link">
  小程序
</a></li></ul></li><li class="dropdown-item"><h4>
          感兴趣
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/kt-vuepress/zh/interest/id.html" class="nav-link">
  身份号码
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/vuejs/vuepress/blob/master/packages/docs/docs/.vuepress/nav/zh.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  参考
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/kt-vuepress/zh/other/" class="nav-link">
  其他
</a></div> <a href="https://github.com/likwotsing/kt-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kt-vuepress/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/kt-vuepress/zh/server/" class="nav-link">
  Sever
</a></div><div class="nav-item"><a href="/kt-vuepress/zh/javascript/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/kt-vuepress/zh/node/" class="nav-link router-link-active">
  Node
</a></div><div class="nav-item"><a href="/kt-vuepress/zh/explore/" class="nav-link">
  探索
</a></div><div class="nav-item"><a href="/kt-vuepress/zh/relation/" class="nav-link">
  相关
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          微信
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/kt-vuepress/zh/wx/gzh.html" class="nav-link">
  公众号
</a></li><li class="dropdown-subitem"><a href="/kt-vuepress/zh/wx/xcx.html" class="nav-link">
  小程序
</a></li></ul></li><li class="dropdown-item"><h4>
          感兴趣
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/kt-vuepress/zh/interest/id.html" class="nav-link">
  身份号码
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/vuejs/vuepress/blob/master/packages/docs/docs/.vuepress/nav/zh.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  参考
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/kt-vuepress/zh/other/" class="nav-link">
  其他
</a></div> <a href="https://github.com/likwotsing/kt-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kt-vuepress/zh/node/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/kt-vuepress/zh/node/node.html" class="sidebar-link">Node</a></li><li><a href="/kt-vuepress/zh/node/node-tool.html" class="sidebar-link">Node相关工具</a></li><li><a href="/kt-vuepress/zh/node/http.html" aria-current="page" class="active sidebar-link">HTTP缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kt-vuepress/zh/node/http.html#web缓存" class="sidebar-link">Web缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kt-vuepress/zh/node/http.html#目的" class="sidebar-link">目的</a></li><li class="sidebar-sub-header"><a href="/kt-vuepress/zh/node/http.html#作用" class="sidebar-link">作用</a></li></ul></li><li class="sidebar-sub-header"><a href="/kt-vuepress/zh/node/http.html#强缓存策略" class="sidebar-link">强缓存策略</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kt-vuepress/zh/node/http.html#http1-0" class="sidebar-link">HTTP1.0</a></li><li class="sidebar-sub-header"><a href="/kt-vuepress/zh/node/http.html#http1-1" class="sidebar-link">HTTP1.1</a></li></ul></li><li class="sidebar-sub-header"><a href="/kt-vuepress/zh/node/http.html#协商缓存" class="sidebar-link">协商缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kt-vuepress/zh/node/http.html#last-modified-if-modified-since" class="sidebar-link">last-modified &amp; if-Modified-Since</a></li><li class="sidebar-sub-header"><a href="/kt-vuepress/zh/node/http.html#etag-if-none-match" class="sidebar-link">etag &amp; if-None-Match</a></li></ul></li><li class="sidebar-sub-header"><a href="/kt-vuepress/zh/node/http.html#ajax缓存" class="sidebar-link">AJAX缓存</a></li><li class="sidebar-sub-header"><a href="/kt-vuepress/zh/node/http.html#serviceworker" class="sidebar-link">ServiceWorker</a></li></ul></li><li><a href="/kt-vuepress/zh/node/crawler.html" class="sidebar-link">Crawler</a></li><li><a href="/kt-vuepress/zh/node/typescript.html" class="sidebar-link">TypeScript</a></li><li><a href="/kt-vuepress/zh/node/login.html" class="sidebar-link">登录</a></li><li><a href="/kt-vuepress/zh/node/express.html" class="sidebar-link">Express</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="http缓存"><a href="#http缓存" class="header-anchor">#</a> HTTP缓存</h1> <h2 id="web缓存"><a href="#web缓存" class="header-anchor">#</a> Web缓存</h2> <h3 id="目的"><a href="#目的" class="header-anchor">#</a> 目的</h3> <p>当浏览器加载一个面时，html引用的外部资源也会加载，但有些资源是不经常变化的，如图片、css、js，如果每次都加载这些资源势必会带来资源的浪费，而且加载时间过长也会影响用户体验。</p> <p>HTTP缓存技术就是为了解决这个问题的。简单的讲HTTP缓存就是讲静态资源存储在浏览器内部，下次请求相同资源时可以直接使用。</p> <p>当然何时使用何时不使用要有一些策略保证，如果资源一旦更新，缓存也要随之更新。</p> <h3 id="作用"><a href="#作用" class="header-anchor">#</a> 作用</h3> <ul><li>提高首屏加载速度，优化用户体验</li> <li>减少流量消耗</li> <li>减轻服务器压力</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">updateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>time
<span class="token punctuation">}</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> url <span class="token punctuation">}</span> <span class="token operator">=</span> req
  <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;html&gt;
        html updatetime is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">updateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
        &lt;script src=&quot;main.js&quot;&gt;&lt;/script&gt;
      &lt;/html&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/main.js'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">document.writeln('&lt;br /&gt;js updatetime is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">updateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')</span><span class="token template-punctuation string">`</span></span>
    <span class="token comment">// 强缓存</span>
    <span class="token comment">// res.setHeader('Expires', new Date(Date.now() + 10 * 1000).toUTCString())</span>
    <span class="token comment">// res.setHeader('Cache-Control', 'max-age=5')</span>
    <span class="token comment">// 协商缓存</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Cache-Control'</span><span class="token punctuation">,</span> <span class="token string">'no-cache'</span><span class="token punctuation">)</span>
    <span class="token comment">// res.setHeader('Last-Modified', new Date().toUTCString())</span>
    <span class="token comment">// if (new Date(req.headers['if-modified-since']).getTime() + 3 * 1000 &gt; Date.now()) {</span>
    <span class="token comment">//   console.log('协商缓存命中...')</span>
    <span class="token comment">//   res.statusCode = 304</span>
    <span class="token comment">//   res.end()</span>
    <span class="token comment">//   return</span>
    <span class="token comment">// }</span>
    <span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> hash <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'sha1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'etag'</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'if-none-match'</span><span class="token punctuation">]</span> <span class="token operator">===</span> hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'etag 缓存命中...'</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">304</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/favicon.ico'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://localhost:3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p><a href="http://nodejs.cn/api/http.html#http_message_headers" target="_blank" rel="noopener noreferrer">http message.headers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://nodejs.org/dist/latest-v12.x/docs/api/http2.html#http2_headers_object" target="_blank" rel="noopener noreferrer">http2 message.headers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>node里的headers都是<strong>小写</strong>，如<code>if-none-match</code></li></ul> <h2 id="强缓存策略"><a href="#强缓存策略" class="header-anchor">#</a> 强缓存策略</h2> <p>直接从本地副本比对读取，<strong>不去请求服务器</strong>，返回的状态码是<strong>200</strong>。</p> <p>可能存在的问题是如果不去服务器请求，如果静态资源更新了而浏览器还在使用旧的静态资源怎么办呢？答案是使用定时器的方式，也就是强缓存可以设置静态资源的有效期。如果超过有效期就认为缓存作废。</p> <h3 id="http1-0"><a href="#http1-0" class="header-anchor">#</a> HTTP1.0</h3> <h4 id="expires"><a href="#expires" class="header-anchor">#</a> expires</h4> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Expires" target="_blank" rel="noopener noreferrer">expires<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是<code>HTTP1.0</code>中定义的缓存字段。当请求一个资源，服务器返回时，可以在<code>Response Headers</code>中增加<code>expires</code>字段表示资源的过期时间。</p> <div class="language-js extra-class"><pre class="language-js"><code>expires<span class="token operator">:</span> Mon<span class="token punctuation">,</span> <span class="token number">24</span> Aug <span class="token number">2020</span> <span class="token number">06</span><span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">26</span> <span class="token constant">GMT</span>
</code></pre></div><p>它是一个<strong>时间戳</strong>（准确的说应该叫<a href="%5Bhttps://baike.baidu.com/item/%E6%A0%BC%E6%9E%97%E5%B0%BC%E6%B2%BB/3065623#viewPageContent%5D(https://baike.baidu.com/item/%E6%A0%BC%E6%9E%97%E5%B0%BC%E6%B2%BB/3065623#viewPageContent)">格林尼治</a>时间），当客户端再次请求该资源的时候，会把客户端时间与该时间戳进行对比，如果大于该时间戳则已过期，否则直接使用该缓存资源。</p> <p>但是有个问题，发送请求时使用的是<strong>客户端时间</strong>去对比。</p> <ul><li>客户端和服务器端时间可能快慢不一致</li> <li>客户端的时间是可以自行修改的(如浏览器是跟随系统时间的，用户可以修改电脑的系统时间)</li></ul> <p>解决的办法是使用HTTP1.1的<code>cache-control</code></p> <h3 id="http1-1"><a href="#http1-1" class="header-anchor">#</a> HTTP1.1</h3> <h4 id="cache-control"><a href="#cache-control" class="header-anchor">#</a> cache-control</h4> <p>HTTP1.1新增了<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="noopener noreferrer">cache-control<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>字段来解决<code>expires</code>存在的问题，<strong>当<code>cache-control</code>和<code>expires</code>都存在时，<code>cache-control</code>的优先级更高</strong>。该字段是一个时间长度，单位秒，表示该资源经过多少秒后失效。当客户端请求资源的时候，发现该资源还在有效时间内则使用该缓存，它<strong>不依赖客户端时间</strong>。<code>cache-control</code>主要有<code>max-age</code>和<code>s-maxage</code>、<code>public</code>和<code>private</code>、<code>no-cache</code>和<code>no-store</code>等值。</p> <h5 id="可缓存性"><a href="#可缓存性" class="header-anchor">#</a> 可缓存性</h5> <table><thead><tr><th>指令名称</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td>public</td> <td style="text-align:center;">所有内容都将被缓存(客户端和代理服务器都可以缓存)，如：可以缓存请求方法为POST的请求</td></tr> <tr><td>private</td> <td style="text-align:center;">只能被单个用户缓存，不能作为共享缓存(即代理服务器不能缓存)，即客户端可以缓存</td></tr> <tr><td>no-cache</td> <td style="text-align:center;">需要使用协商缓存来验证缓存数据</td></tr> <tr><td>no-store</td> <td style="text-align:center;">不使用缓存</td></tr></tbody></table> <h5 id="到期"><a href="#到期" class="header-anchor">#</a> 到期</h5> <table><thead><tr><th>指令名称</th> <th>说明</th></tr></thead> <tbody><tr><td>max-age=&lt;seconds&gt;</td> <td>超过seconds后被认为过期(秒)，与<code>expires</code>相反，时间是相对于请求的时间。这个选项只在HTTP1.1可用，在和Last-Modified一起使用时，优先级较高</td></tr></tbody></table> <h5 id="重新验证和重新加载"><a href="#重新验证和重新加载" class="header-anchor">#</a> 重新验证和重新加载</h5> <table><thead><tr><th>指令名称</th> <th>说明</th></tr></thead> <tbody><tr><td>must-revalidate</td> <td>如果缓存的内容失效，请求必须发送到服务器/代理以进行重新验证</td></tr> <tr><td>proxy-revalidate</td> <td>和must-revalidate作用相同，仅适用于共享缓存(如代理)，并被私有缓存忽略</td></tr></tbody></table> <h2 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h2> <p>强缓存的<code>expires</code>和<code>cache-control</code>都会<strong>访问本地缓存直接验证</strong>是否过期，如果没过期直接使用本地缓存，并返回200。但如果设置了<code>no-cache</code>和<code>no-store</code>则本地缓存会被忽略，会去<strong>请求服务器验证资源是否更新</strong>，如果没有更新才继续使用本地缓存，此时返回的是304，这就是协商缓存。协商缓存主要包括<code>last-modified</code>和<code>etag</code>。</p> <p>协商缓存简单的说就是浏览器和服务器间就是否要使用缓存在做协商。如果协商的结果是需要更新就会返回200并返回更新内容；如果不需要只需要返回状态码304不用返回内容，这样虽然需要后端应答但是后端既不需要生成内容也不需要传输内容，依然可以享受缓存的好处。</p> <h3 id="last-modified-if-modified-since"><a href="#last-modified-if-modified-since" class="header-anchor">#</a> last-modified &amp; if-Modified-Since</h3> <p>通过协商修改时间为基础的策略。</p> <ul><li>if-modified-since：只可以用在GET和HEAD请求中</li></ul> <p><img src="/assets/img/last-modified.png" alt="last-modified"></p> <h3 id="etag-if-none-match"><a href="#etag-if-none-match" class="header-anchor">#</a> etag &amp; if-None-Match</h3> <p>通过内容判断，一般的做法是将返回内容进行摘要(Hash)，然后通过对比摘要来判断内容是否更新。</p> <ul><li><code>if-none-match</code>是在http2的模块里</li> <li>if-none-match和if-match的区别：if-match是<strong>强比较算法</strong>，只有在每一个字节相同的情况下，才认为两个文件是相同的。if-none-match是<strong>弱比较算法</strong>，内容一致也可以认为是相同的。</li> <li>if-none-match比if-modified-since的优先级高</li></ul> <p><img src="/assets/img/etag.png" alt="etag"></p> <h2 id="ajax缓存"><a href="#ajax缓存" class="header-anchor">#</a> AJAX缓存</h2> <h2 id="serviceworker"><a href="#serviceworker" class="header-anchor">#</a> ServiceWorker</h2></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/likwotsing/kt-vuepress/edit/master/docs/zh/node/http.md" target="_blank" rel="noopener noreferrer">在Github 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">17 天前</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/kt-vuepress/zh/node/node-tool.html" class="prev">
        Node相关工具
      </a></span> <span class="next"><a href="/kt-vuepress/zh/node/crawler.html">
        Crawler
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/kt-vuepress/assets/js/app.ed2bf4cb.js" defer></script><script src="/kt-vuepress/assets/js/2.90c87c0b.js" defer></script><script src="/kt-vuepress/assets/js/19.dd52f1c3.js" defer></script>
  </body>
</html>
